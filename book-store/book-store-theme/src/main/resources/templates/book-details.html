<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{ezytheme}">
<body>
<div layout:fragment="content" class="container book-details">
    <div class="row align-items-start">
        <div class="col-lg-3">
            <div class="book-details-image card-panel"
                 th:if="${book.medias != null and !book.medias.isEmpty()}">

                <!-- MAIN -->
                <div class="swiper book-gallery-main">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="m : ${book.medias}">
                            <img class="book-gallery-main-img"
                                 th:src="${m.getUrlOrNull()}"
                                 alt="book image">
                        </div>
                    </div>

                    <div class="swiper-button-prev book-gallery-prev"
                         th:if="${book.medias.size() > 1}"></div>
                    <div class="swiper-button-next book-gallery-next"
                         th:if="${book.medias.size() > 1}"></div>
                </div>

                <!-- THUMBS (BOTTOM) -->
                <div class="swiper book-gallery-thumbs"
                     th:if="${book.medias.size() > 1}">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="m : ${book.medias}">
                            <img class="book-gallery-thumb-img"
                                 th:src="${m.getUrlOrNull()}"
                                 alt="thumb">
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-lg-5">
            <div class="book-details-content card-panel">
                <div class="book-details-header">
                    <p class="eyebrow">[[#{book_details}]]</p>
                    <h1 class="book-details-title">[[${book_name}]]</h1>
                </div>
                <div class="book-details-description">
                    <h4>[[#{description}]]</h4>
                    <div class="description-body" th:utext="${book.description}"></div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="book-details-checkout card-panel">
                <div class="book-details-price">
                    <div class="price">[[${book.formattedPriceIncludeSymbol}]]</div>
                    <div class="price-meta">
                        <span class="original-price"
                              th:if="${book.discountPercent > 0}">
                            [[${book.formattedOriginalPriceIncludeSymbol}]]
                        </span>
                        <span class="discount-badge"
                              th:if="${book.discountPercent > 0}">
                            [[${'- ' + book.discountPercent + ' %'}]]
                        </span>
                    </div>
                </div>
                <p class="book-details-note">
                    Secure checkout Â· Instant access
                </p>
                <div class="book-details-actions">
                    <button type="button" class="btn btn-outline-primary"
                            th:attr="onclick=|addBookToCart(${book.id})|">
                        [[#{add_to_cart}]]
                    </button>
                    <button type="button" class="btn btn-primary"
                            th:attr="onclick=|buyBookNow(${book.id})|">
                        [[#{buy_now}]]
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="common-spacing-3"></div>
    <div class="container">
        <h1 class="mb-4">[[#{more_by_this_author}]]</h1>
        <div class="books">
            <th:block th:each="book : ${sameAuthorBooks}">
                <th:block th:replace="~{fragments/book-item :: content(book=${book})}"/>
            </th:block>
        </div>
    </div>
</div>
<script layout:fragment="scripts" th:inline="javascript">
    $(function () {
        var $main = $('.book-gallery-main');
        var $thumbs = $('.book-gallery-thumbs');

        if (!$main.length) return;

        var thumbsSwiper = null;

        if ($thumbs.length) {
            thumbsSwiper = new Swiper('.book-gallery-thumbs', {
                direction: 'horizontal',
                slidesPerView: 4,
                spaceBetween: 10,
                watchSlidesProgress: true,
                speed: 400,
                threshold: 5
            });
        }

        new Swiper('.book-gallery-main', {
            loop: false,
            spaceBetween: 10,
            navigation: {
                nextEl: '.book-gallery-next',
                prevEl: '.book-gallery-prev'
            },
            thumbs: thumbsSwiper ? {swiper: thumbsSwiper} : undefined,

            on: {
                slideChange: function () {
                    if (thumbsSwiper) {
                        thumbsSwiper.slideTo(this.activeIndex - 1);
                    }
                }
            }
        });
    });
</script>
</body>
</html>
