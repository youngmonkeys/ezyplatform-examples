<!--
 ~ Copyright 2022 youngmonkeys.org
 ~ 
 ~ Licensed under the ezyplatform, Version 1.0.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~ 
 ~     https://youngmonkeys.org/licenses/ezyplatform-1.0.0.txt
 ~ 
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
-->

<!DOCTYPE html>
<html
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:ezy="http://www.ezyplatform.com/thymeleaf/layout">

<head th:remove="tag">
	<th:block th:if="${commonFragments.get('styles') == null || commonFragments.get('styles').content == 'styles'}">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/style.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/header.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/footer.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/home.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/store.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/book-details.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/css/post.css" />
		<link rel="stylesheet" type="text/css" ezy:vhref="/ezylogin/css/style.css" />
	</th:block>
	<th:block th:if="${commonFragments.get('styles') != null && commonFragments.get('styles').content != 'styles'}">
        <ezy:block ezy:utext="${commonFragments.get('styles').content}" />
    </th:block>
	<th:block th:if="${commonFragments.get('header') != null && !#strings.isEmpty(commonFragments.get('header').additionalHead)}">
        <ezy:block ezy:utext="${commonFragments.get('header').additionalHead}" />
    </th:block>
	<th:block th:if="${pageFragments != null && pageFragments.get('container') != null && !#strings.isEmpty(pageFragments.get('container').additionalHead)}">
        <ezy:block ezy:utext="${pageFragments.get('container').additionalHead}" />
    </th:block>
	<th:block th:if="${commonFragments.get('footer') != null && !#strings.isEmpty(commonFragments.get('footer').additionalHead)}">
        <ezy:block ezy:utext="${commonFragments.get('footer').additionalHead}" />
    </th:block>
	<style th:inline="css">
		.custom-file-label::after {
			content: "[[#{browse}]]" !important;
		}
	</style>
</head>
<body th:remove="tag">

<th:block th:replace="~{ezycommon/toast :: content}" />

<div class="wrapper">
	<th:block th:if="${commonFragments.get('header') != null && commonFragments.get('header').content != 'header'}">
		<ezy:block ezy:utext="${commonFragments.get('header').content}" />
	</th:block>
	<th:block th:if="${commonFragments.get('header') == null || commonFragments.get('header').content == 'header'}">
		<header class="header">
			<th:block th:replace="~{fragments/header :: header}" />
		</header>
	</th:block>
	<th:block th:if="${pageFragments != null && pageFragments.get('container') != null && pageFragments.get('container').content != 'container'}">
		<ezy:block ezy:utext="${pageFragments.get('container').content}" />
	</th:block>
	<th:block th:if="${pageFragments == null || pageFragments.get('container') == null || pageFragments.get('container').content == 'container'}">
		<main>
			<th:block layout:fragment="content" />
		</main>
	</th:block>
	<th:block th:if="${commonFragments.get('footer') != null && commonFragments.get('footer').content != 'footer'}">
		<th:block th:utext="${commonFragments.get('footer').content}" />
	</th:block>
	<th:block th:if="${commonFragments.get('footer') == null || commonFragments.get('footer').content == 'footer'}">
		<th:block th:replace="~{fragments/footer :: footer}" />
	</th:block>
</div>

<th:block th:replace="~{ezycommon/loading :: content}" />

<th:block th:if="${loggedIn != true}">
<div th:replace="~{ezylogin/login :: content}"></div>
<div th:replace="~{ezylogin/register :: content}"></div>
<div th:replace="~{ezylogin/forgot-password :: content}"></div>
</th:block>

<th:block th:replace="~{ezycommon/alert :: content}" />
<th:block th:replace="~{ezycommon/toast :: content}" />

<th:block layout:fragment="modals"></th:block>

<th:block th:if="${commonFragments.get('scripts') == null || commonFragments.get('scripts').content == 'scripts'}">
	<!-- REQUIRED SCRIPTS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/js/bootstrap.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bs-custom-file-input/1.3.4/bs-custom-file-input.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</th:block>

<th:block th:if="${commonFragments.get('scripts') != null && commonFragments.get('scripts').content != 'scripts'}">
    <ezy:block ezy:utext="${commonFragments.get('scripts').content}" />
</th:block>

<!-- OPTIONAL SCRIPTS -->
<th:block layout:fragment="import-scripts" th:remove="tag" />
<script th:inline="javascript">
/*<![CDATA[*/
var showRegister = /*[[${showRegister}]]*/ '';
var showLogin = /*[[${showLogin}]]*/ '';
var loggedIn = /*[[${loggedIn}]]*/ '';
var userStatus = /*[[${user != null ? user.status : ''}]]*/ '';
/*]]>*/
</script>
<th:block layout:fragment="pre-main-scripts" />
<th:block layout:fragment="scripts" />
<th:block layout:fragment="post-scripts" />
<script>
$( document ).ready(function() {
	ezyweb.formatDateStringElements();
    ezyweb.formatDateTimeStringElements();
    ezyweb.formatDateTimeMinuteStringElements();
    ezyweb.formatStatusTextElements();
    ezyweb.formatNumberWithCommasElements();
    if (ezyweb.lang) {
		ezyweb.appendLangParameterToLinks(ezyweb.lang);
    }
});

var superRedirectToLogin = ezyweb.redirectToLogin;
ezyweb.redirectToLogin = function() {
	if (typeof showLoginModal === 'function') {
		showLoginModal()
	} else {
		superRedirectToLogin();
	}
}

var addBookToCart = function(bookId) {
	registerProductToShoppingCartRequest = {
		onSuccessCallback: fetchShoppingCartProductCount
	};
	registerProductToShoppingCart(bookId);
}
</script>
<th:block th:if="${loggedIn != true}">
	<th:block th:replace="~{ezylogin/login :: scripts}" />
	<th:block th:replace="~{ezylogin/register :: scripts}" />
	<th:block th:replace="~{ezylogin/forgot-password :: scripts}" />
</th:block>
<th:block th:replace="~{ezycommon/alert :: scripts}" />
<th:block th:replace="~{ezycommon/toast :: scripts}" />
<th:block th:replace="~{fragments/header :: scripts}" />
<th:block th:if="${loggedIn == true}">
	<th:block th:replace="~{ezyaccount/notification :: scripts}" />
	<th:block th:replace="~{ecommerce/checkout/scripts :: common}" />
	<th:block th:replace="~{ecommerce/checkout/scripts :: register-product}" />
	<th:block th:replace="~{ecommerce/shopping-cart/scripts :: product-count}" />
</th:block>
<th:block th:if="${commonFragments.get('header') != null && !#strings.isEmpty(commonFragments.get('header').additionalFoot)}">
	<ezy:block ezy:utext="${commonFragments.get('header').additionalFoot}" />
</th:block>
<th:block th:if="${commonFragments.get('header') == null || #strings.isEmpty(commonFragments.get('header').additionalFoot)}">
	<th:block th:replace="~{fragments/header :: scripts}" />
</th:block>
<th:block th:if="${commonFragments.get('footer') != null && !#strings.isEmpty(commonFragments.get('footer').additionalFoot)}">
	<ezy:block ezy:utext="${commonFragments.get('footer').additionalFoot}" />
</th:block>
<script>
$(document).ready(function () {
	if (loggedIn) {
		fetchShoppingCartProductCount();
	}
});
</script>
</body>
</html>
